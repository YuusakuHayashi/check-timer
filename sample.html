<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
  </head>
  <div id="usability"></div>
  <div id="time"></div>
  <script>

    var usability = document.getElementById('usability');
    var time = document.getElementById('time');

    var state = false;
    var outer_cnt = 0;
    var inner_cnt = 0;
    var INTERVAL = 5;

    function main(){

      function getUsability(){
        return Math.abs(Math.floor(Math.random()*10)) < 6 ? true : false; 
      };
      function wrapper(){
        state = getUsability();					
        usability.innerHTML = state ? '使用中' : '空室中';   
        if(state){
          outer_cnt++;
        }else{
          outer_cnt = 0;
        }      
        time.innerHTML = outer_cnt;
      };

      switch(inner_cnt){
        case 0:
          wrapper();
          break;
        case INTERVAL:
          wrapper();
          inner_cnt = 0;
          break;
        default:
          if(state){
            outer_cnt++;
          }else{
            outer_cnt = 0;
          }      
          time.innerHTML = outer_cnt;
          break;
      };

      inner_cnt++;

      setTimeout(main, 1000);
    };
    main();

  </script>
</html>

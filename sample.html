<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
  </head>
  <div id="usability"></div>
  <div id="time"></div>
  <script>

    var usability = document.getElementById('usability');
    var time = document.getElementById('time');

    var outer_cnt = 0;
    var inner_cnt = 0;
    var inner_state;
    var outer_state;

    var INTERVAL = 5;

    function timer(){
      var rand = Math.abs(Math.floor(Math.random()*10)) < 6 ? true : false;

      function changeInnerStatus(rand){
        if(rand){ 
	  inner_state = true;
        }else{
	  inner_state = false;
        }
      };

      function changeOuterStatus(state){
        if(state){
          outer_state = true;	
	}else{
          outer_state = false;	
	}
      };

      function displayStatus(state){
        if(state){ 
          usability.innerHTML = '使用中';
        }else{
          usability.innerHTML = '空室中';
        }
      };

      function displayCount(state){
        if(state){
          console.log('use');
          outer_cnt++;
	}else{
          console.log('nouse');
          outer_cnt = 0;
	}      
        time.innerHTML = outer_cnt;
      };

      function wrapper(){
	changeInnerStatus(rand);
        displayStatus(inner_state);
	changeOuterStatus(inner_state);
        displayCount(outer_state);
      };

      switch(inner_cnt){
        case 0:
          wrapper();
          break;
        case INTERVAL:
          wrapper();
	  inner_cnt = 0;
          break;
	default:
	  displayCount(outer_state);
	  break;
      };

      inner_cnt++;

      setTimeout(timer, 1000);
    };
    timer();

  </script>
</html>
